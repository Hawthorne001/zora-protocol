name: "Legacy Contracts"

on: 
  workflow_dispatch:

jobs:
  contracts-erc20z:
    name: ERC20Z Contracts
    uses: ./.github/workflows/contract.yml
    secrets: inherit
    with:
      package_folder: legacy/erc20z
      name: ERC20Z
      ignore_coverage_files: '"*lib*" "*Zora1155*" "*uniswap*"'
      # fixes stack too deep temporarily
      coverage_args: "--ir-minimum"

  contracts-1155:
    name: 1155 Contracts
    uses: ./.github/workflows/contract.yml
    secrets: inherit
    with:
      package_folder: legacy/1155-contracts
      ignore_coverage_files: '"*DeploymentConfig*" "*Redeem*" "*deployment*" "*packages*" "*test*"'
      name: 1155 Contracts

  contracts-sparks:
    name: Sparks
    uses: ./.github/workflows/contract.yml
    secrets: inherit
    with:
      package_folder: legacy/sparks
      ignore_coverage_files: '"*Ownable*" "*Mock*" "*BatchDataHelper*" "*test*" "*script*" "src/deployment/*"'
      skip_storage_layout: true
      name: Sparks

  contracts-1155-deployments:
    name: 1155 Deployments
    uses: ./.github/workflows/deployment.yml
    secrets: inherit
    with:
      package_folder: legacy/1155-deployments
      precache: "pnpm run generate"

  contracts-cointags:
    name: Cointags
    uses: ./.github/workflows/contract.yml
    secrets: inherit
    with:
      package_folder: legacy/cointags
      name: Cointags
      ignore_coverage_files: '"*script*"'
      skip_storage_layout: true

  contracts-protocol-rewards:
    name: Protocol Rewards
    uses: ./.github/workflows/contract.yml
    secrets: inherit
    with:
      package_folder: legacy/protocol-rewards
      name: Rewards
      ignore_coverage_files: '"*lib*"'
      skip_storage_layout: true

  js-protocol-sdk:
    name: Protocol SDK
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
      - name: Install node deps and foundry
        uses: ./.github/actions/setup_deps
      - name: Build protocol-sdk
        run: |
          cd legacy/protocol-sdk && pnpm build
      - name: Test protocol-sdk
        run: |
          cd legacy/protocol-sdk && pnpm test:js:legacy